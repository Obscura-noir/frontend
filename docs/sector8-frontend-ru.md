# SECTOR 8 - Требования к frontend-части с поддержкой приватных транзакций

## 1. Обзор

### 1.1 Цель документа
Данный документ описывает требования к frontend-части минимально жизнеспособного продукта (MVP) для SECTOR 8 — веб-приложения для безопасных трансграничных транзакций между платежными агентами и брокерами, развертываемого в сети TOR для обеспечения максимальной анонимности и защиты от блокировок. Документ включает требования по интеграции с Private Execution Environment (PXE) для работы с приватными транзакциями на основе технологий zk.

### 1.2 Ключевые ценности MVP
- Абсолютная приватность пользователей и их транзакций
- Устойчивость к цензуре и блокировкам через TOR-сеть
- Защита критически важных данных на всех уровнях взаимодействия
- Интуитивно понятный интерфейс даже при высоких задержках TOR-сети
- Минимизация утечек данных через фронтенд-взаимодействие
- Устойчивость к разрывам соединения и нестабильной работе сети
- Локальная обработка конфиденциальных данных через PXE
- Поддержка генерации ZK-доказательств на стороне клиента

### 1.3 Технический стек
- **Framework:** React.js + TypeScript с минимизацией внешних зависимостей
- **UI библиотека:** Собственная минималистичная библиотека компонентов на основе базового CSS (без внешних CDN)
- **Управление состоянием:** Redux с сохранением критического состояния в зашифрованном localStorage
- **Роутинг:** Облегченный React Router с поддержкой офлайн-режима
- **Формы:** Собственная реализация форм с минимальными зависимостями
- **HTTP-клиент:** Axios с настроенными дополнительными тайм-аутами для TOR
- **Шифрование на клиенте:** Web Crypto API и/или libsodium-wrappers
- **Веб-сокеты:** Адаптированный Socket.io-client с поддержкой долгих задержек
- **ZK-инфраструктура:** 
  - Интеграция с Noir-компилятором для генерации и обработки ZK-доказательств
  - Адаптированный PXE (Private Execution Environment) для работы с EVM
  - Библиотеки для управления приватными нотами и ключами
  - Клиентские верификаторы для базовых проверок доказательств

## 2. Архитектура фронтенда с PXE

### 2.1 Общая схема архитектуры
```
[User Interface Layer] <-> [Application Logic] <-> [Privacy Layer (PXE)] <-> [Network Layer]
                                                          |
                                                    [Local Storage]
                                                    (Encrypted Notes)
```

### 2.2 Ключевые компоненты архитектуры

#### 2.2.1 User Interface Layer
- Компоненты представления и интерактивные элементы
- Абстрагирован от деталей приватной обработки
- Отображает публичные метаданные и маскированные приватные данные

#### 2.2.2 Application Logic
- Бизнес-логика приложения
- Координация между UI и Privacy Layer
- Управление состоянием приложения через Redux

#### 2.2.3 Privacy Layer (PXE)
- Адаптированный PXE для работы с EVM
- Управление приватными ключами и нотами
- Генерация ZK-доказательств
- Локальная валидация приватных транзакций
- Шифрование и дешифрование данных

#### 2.2.4 Network Layer
- Взаимодействие с backend через защищенные каналы
- Отправка ZK-доказательств для верификации
- Получение и обработка событий приватных транзакций
- Адаптированные интерфейсы для TOR

#### 2.2.5 Local Storage
- Зашифрованное хранение приватных нот
- Управление состоянием nullifiers
- Резервное копирование ключей и критических данных
- Защита от несанкционированного доступа

## 3. Пользовательские роли

- **Неавторизованный пользователь:** Доступ только к лендингу и форме регистрации/входа
- **Авторизованный пользователь:** Полный доступ к функционалу для создания и управления сделками
- **Администратор:** Только для внутреннего использования, не включается в MVP

## 4. Пользовательские сценарии с учетом приватных транзакций

### 4.1 Регистрация и вход
1. Пользователь заходит на главную страницу
2. Выбирает "Регистрация" и вводит email/пароль
3. PXE генерирует приватные ключи локально на устройстве пользователя
4. Создаются базовые ноты для инициализации аккаунта
5. Пользователь получает секретные ключи с инструкциями по безопасному хранению
6. Получает OTP-код и вводит его для подтверждения
7. Заполняет базовую информацию о себе (данные обрабатываются локально через PXE)
8. Загружает минимальный набор документов для KYC-lite (документы шифруются до отправки)
9. Получает доступ к дашборду

### 4.2 Создание сделки
1. Пользователь нажимает "Создать сделку" на дашборде
2. Выбирает тип сделки из предложенных шаблонов
3. Заполняет параметры (сумма, валюта, сроки, условия)
4. PXE локально создает приватную ноту с деталями сделки
5. Генерируется ZK-доказательство валидности транзакции
6. Отображаются только общие метаданные для поиска контрагента
7. Находит или приглашает контрагента
8. PXE создает ZK-доказательство для инициации сделки
9. Просматривает предварительный обзор и отправляет предложение

### 4.3 Согласование условий
1. Контрагент получает уведомление о новом предложении (только общие метаданные)
2. PXE контрагента запрашивает и дешифрует приватные детали
3. Просматривает детали и параметры (локально на устройстве)
4. Обсуждает условия через встроенный end-to-end шифрованный чат
5. PXE создает ZK-доказательство принятия условий
6. После обоюдного согласия сделка переходит в статус "Подтверждена"

### 4.4 Депонирование средств
1. PXE инициатора создает ноту для депонирования с зашифрованными деталями
2. Генерируется ZK-доказательство блокировки средств
3. Пользователь видит инструкции по депонированию
4. В демо-режиме имитация процесса блокировки
5. После подтверждения депозита статус сделки обновляется
6. Обе стороны получают уведомление о начале исполнения условий

### 4.5 Завершение сделки
1. Стороны отмечают выполнение условий через локальный PXE
2. PXE создает ZK-доказательства завершения для каждой стороны
3. Подтверждают завершение со своей стороны
4. После обоюдного подтверждения средства высвобождаются
5. Пользователи оставляют отзывы и оценки друг другу
6. Сделка переходит в статус "Завершена"

### 4.6 Работа с биржевым интерфейсом
1. Пользователь переходит в раздел "Биржа" с дашборда
2. Выбирает интересующую валютную пару из списка доступных
3. Просматривает стакан ордеров с анонимизированными данными о продавцах и покупателях
4. PXE локально расшифровывает данные об ордерах, к которым у пользователя есть доступ
5. Пользователь создает новый ордер, указывая параметры и уровень приватности
6. PXE генерирует ZK-доказательство для валидации параметров ордера
7. После публикации ордера, система автоматически ищет соответствия с существующими ордерами
8. При нахождении подходящего контрагента, пользователь получает уведомление
9. Пользователь может принять сделку и перейти к стандартному процессу транзакции
10. Все параметры ордера и контрагента доступны только через локальный PXE

## 5. Основные экраны и компоненты

### 5.1 Лендинг и авторизация
- **Главная страница:**
  - Минималистичное описание преимуществ без раскрытия конкретной чувствительной информации
  - Кнопки входа и регистрации с поддержкой защищенного ввода
  - Анимации и сложные элементы сведены к минимуму для быстрой загрузки в TOR

- **Регистрация:**
  - Форма с минимальным набором обязательных полей
  - Генерация криптографически стойких паролей по запросу
  - Интеграция с PXE для создания приватных ключей
  - Интерфейс для безопасного резервного копирования ключей
  - Проверка OTP-кода через защищенный канал
  - Опция для полностью анонимного аккаунта без привязки к email

- **Вход:**
  - Защищенная форма с поддержкой виртуальной клавиатуры
  - Интеграция с PXE для проверки учетных данных
  - Строгая 2FA с использованием одноразовых кодов
  - Обязательная проверка через CAPTCHA для защиты от автоматизированных атак
  - Шифрование данных аутентификации прямо в браузере

- **KYC-lite:**
  - Клиентское шифрование документов перед загрузкой
  - Использование PXE для локальной KYC проверки с ZK-доказательствами
  - Возможность скрыть критические части документов
  - Полное удаление метаданных из загружаемых файлов
  - Инструкции по безопасной верификации

### 5.2 Дашборд
- **Верхняя панель:**
  - Индикатор статуса TOR-соединения
  - Индикатор статуса PXE
  - Таймер до автоматического выхода из системы
  - Кнопка экстренного выхода с очисткой данных
  - Счетчик активных сессий

- **Основной контент:**
  - Деперсонализированная статистика активных сделок
  - Минималистичные информационные карточки без избыточных деталей
  - Список активных сделок с кодовыми идентификаторами вместо реальных данных
  - Шифрованные заметки пользователя
  - Индикатор приватных нот и их статусов

- **Боковая панель:**
  - Ссылки на критические разделы приложения
  - Панель мониторинга безопасности
  - Статус анонимизации пользователя
  - Зашифрованные закладки для быстрого доступа
  - Доступ к управлению приватными нотами

### 5.3 Создание сделки
- **Выбор шаблона:**
  - Карточки с типами сделок и описаниями
  - Поиск по шаблонам (при наличии большого количества)

- **Форма параметров:**
  - Поля для суммы, валюты, сроков
  - Выбор условий завершения
  - Описание сделки
  - Возможность загрузки документов
  - Интерфейс для настройки приватности данных

- **Выбор контрагента:**
  - Поиск по системе с использованием ZK для сокрытия деталей запроса
  - Приглашение по email
  - Проверка рейтинга и истории
  - Настройка уровня раскрытия информации для контрагента

- **Превью сделки:**
  - Сводка всех параметров
  - Индикация приватных и публичных полей
  - Кнопка отправки предложения с генерацией ZK-доказательства

### 5.4 Детали сделки
- **Информационный блок:**
  - Стороны сделки (анонимизированные данные)
  - Сумма, валюта, сроки (с опцией раскрытия через PXE)
  - Текущий статус с визуальным индикатором
  - История изменений с сохранением приватности

- **Блок действий:**
  - Кнопки в зависимости от статуса сделки
  - Инструкции по текущему этапу
  - Загрузка документов с клиентским шифрованием
  - Интеграция с PXE для генерации доказательств действий

- **Чат:**
  - Защищенный E2E шифрованный чат между участниками
  - Индикатор "Печатает..."
  - Возможность отправки зашифрованных файлов
  - Автоматическое удаление сообщений по расписанию

### 5.5 Профиль пользователя
- **Общая информация:**
  - Уникальный ID (без личных данных)
  - Дата регистрации
  - Статус верификации с приватностью деталей

- **Рейтинг и отзывы:**
  - Средний рейтинг с визуализацией
  - Список отзывов от контрагентов
  - Количество успешных сделок
  - ZK-подтверждения транзакций без раскрытия деталей

- **История сделок:**
  - Список завершенных сделок с приватными деталями
  - Фильтрация по типу, статусу, дате
  - Локальное дешифрование данных через PXE

### 5.6 Управление нотами и ключами
- **Просмотр приватных нот:**
  - Список активных нот пользователя
  - Статус каждой ноты (активна, использована, в ожидании)
  - Опция резервного копирования зашифрованных нот

- **Управление ключами:**
  - Интерфейс для просмотра публичных ключей
  - Возможность ротации ключей
  - Функция экспорта зашифрованных ключей
  - Процедура восстановления из резервной копии

- **Настройки приватности:**
  - Уровни раскрытия информации для разных контрагентов
  - Управление временем хранения данных
  - Настройка автоматического удаления шифрованных данных

### 5.7 Биржевой интерфейс (Стакан ордеров)

#### 5.7.1 Основной вид стакана ордеров
- **Секция заголовка:**
  - Селектор валютной пары (например, USD/RUB, EUR/CNY)
  - Фильтр временных рамок (24ч, 7д, 30д) для исторических данных
  - Рыночная статистика (объем за 24ч, изменение цены %)
  - Переключение между "Все лоты" и "Мои активные лоты"

- **Панель стакана ордеров:**
  - Двухколоночный макет (Ордера на покупку и продажу)
  - Цветовая кодировка ценовых уровней (зеленый для покупки, красный для продажи)
  - Агрегированный объем на каждом ценовом уровне
  - Визуализация глубины с горизонтальными полосами
  - Приватно-ориентированное отображение с псевдонимными ID
  - Индикаторы TrustScore рядом с каждым ордером
  - Опциональный индикатор спреда между наивысшей ценой покупки и наименьшей ценой продажи

- **Элементы управления стаканом:**
  - Селектор точности (количество отображаемых десятичных знаков)
  - Селектор группировки (ценовые шаги для агрегации)
  - Настройки отображения (подсветка собственных ордеров, показ/скрытие TrustScore)
  - Переключатель приватности для маскировки размеров ордеров

- **Кнопки быстрого действия:**
  - Кнопки "Создать ордер на покупку" и "Создать ордер на продажу"
  - Опция одного клика для сопоставления с лучшим доступным контрагентом

#### 5.7.2 Детальный просмотр лота
- **Панель деталей ордера:**
  - Полные спецификации выбранного лота
  - Анонимизированный профиль агента с TrustScore
  - Параметры транзакции (способы оплаты, временные рамки)
  - Информация о географическом маршруте (страны, юрисдикции)
  - Исторические метрики производительности агента
  - PXE-контроль приватности для конфиденциальной информации

- **Панель действий:**
  - Кнопка "Сопоставить ордер" для инициации транзакции
  - Кнопка "Связаться с агентом" для E2E шифрованного чата
  - "Добавить в список наблюдения" для мониторинга
  - Опция "Поделиться" с приватно-сохраняющей ссылкой

#### 5.7.3 Расширенное создание ордера
- **Выбор типа ордера:**
  - Рыночные ордера (немедленное исполнение по лучшей цене)
  - Лимитные ордера (исполнение по определенной цене или лучше)
  - Условные ордера на основе рыночных событий

- **Конфигурация параметров:**
  - Поля для цены и объема
  - Выбор способа оплаты (крипто, фиатные опции)
  - Предпочтения географического маршрута
  - Временные ограничения
  - Минимальные требования к TrustScore контрагента
  - Настройки приватности для видимости ордера

- **Предпросмотр и подтверждение:**
  - Отображение расчета комиссии
  - Оценка времени до сопоставления
  - Сравнение с текущими рыночными курсами
  - Индикатор прогресса генерации ZK-доказательства
  - Финальное подтверждение с PXE подписью

#### 5.7.4 Обзорная панель рынка
- **Рыночная сводка:**
  - Тепловая карта активности валютных пар
  - Распределение объема по валютным парам
  - Ценовые индикаторы, взвешенные по TrustScore
  - Недавно завершенные транзакции (анонимизированные)

- **Компоненты визуализации:**
  - Графики цены/объема с настраиваемыми временными рамками
  - График глубины, показывающий кумулятивный объем стакана
  - Индикаторы рыночного настроения на основе дисбаланса ордеров
  - Карта региональной активности (анонимизированные географические данные)

- **Фильтр и поиск:**
  - Многопараметрический поиск для конкретных лотов
  - Фильтрация по валюте, диапазону объема, способу оплаты
  - Минимальный порог TrustScore
  - Опции географического маршрута
  - Расширенный фильтр для сложных комбинаций

## 6. Дизайн и UX

### 6.1 Стилевой дизайн
- **Цветовая схема:**
  - Основные цвета: тёмно-синий, белый, акцент зеленый
  - Статусы: зеленый (успех), желтый (в процессе), красный (проблема)
  - Дополнительная цветовая индикация для приватных элементов

- **Типографика:**
  - Системные шрифты для максимальной производительности
  - Четкая иерархия заголовков
  - Акцентирование приватных данных стилистически

- **Иконки:**
  - Использование Material Icons для единообразия
  - Кастомные иконки для уникальных функций
  - Специальные иконки для обозначения приватности

### 6.2 Отзывчивый дизайн
- Адаптация под все размеры экранов (desktop, tablet, mobile)
- Специальный лейаут для мобильных устройств
- Оптимизация для сенсорных экранов
- Режим экономии трафика для медленных соединений

### 6.3 UX принципы
- Минимальное количество шагов для выполнения действий
- Понятная обратная связь на все действия пользователя
- Интуитивная навигация и структура
- Информативные уведомления о статусе операций
- Четкая индикация приватных и публичных данных
- Визуальные подсказки по работе с PXE

### 6.4 Биржевой дизайн и UX

#### 6.4.1 Визуальный дизайн стакана ордеров
- **Цветовая схема:**
  - Ордера на покупку: Зеленый градиент (темнее = больший объем)
  - Ордера на продажу: Красный градиент (темнее = больший объем)
  - Подсветка сопоставленных ордеров: Пульсирующая синяя анимация
  - Подсветка собственных ордеров: Золотая рамка

- **Типографика:**
  - Моноширинные шрифты для числовых значений
  - Четкая визуальная иерархия с акцентом на цену
  - Компактный, но читаемый макет для плотной информации

- **Интерактивные элементы:**
  - Состояния при наведении, раскрывающие дополнительные детали ордера
  - Действия по клику для выбора ордера
  - Функциональность перетаскивания для перемещения ценовых оповещений
  - Поддержка жестов для мобильного взаимодействия

#### 6.4.2 Принципы UX для биржи
- **Мгновенная обратная связь:**
  - Визуальные индикаторы обновлений стакана
  - Тонкие анимации для движений цены
  - Всплывающие уведомления для значимых рыночных событий
  - Индикаторы статуса прогресса сопоставления ордеров

- **Эффективная информационная иерархия:**
  - Фокус на критических точках данных (цена, объем, TrustScore)
  - Прогрессивное раскрытие детальной информации
  - Настраиваемый макет для приоритезации личных предпочтений
  - Сочетания клавиш для продвинутых пользователей

- **TOR-оптимизированная производительность:**
  - Сжатие данных стакана для минимальной пропускной способности
  - Дельта-обновления вместо полных обновлений
  - Локально кэшированный стакан с выборочными обновлениями
  - Резервные режимы отображения для нестабильных соединений

## 7. Компоненты и модули

### 7.1 Общие компоненты
- Header (шапка с навигацией)
- Footer (подвал с информацией)
- Button (кнопки разных типов)
- Input (текстовые поля)
- Select (выпадающие списки)
- Modal (модальные окна)
- Notification (уведомления)
- Loader (индикаторы загрузки)
- Card (карточки для отображения информации)
- Table (таблицы для списков)
- PrivacyToggle (переключатель режима приватности)
- ZKProofIndicator (индикатор статуса доказательства)

### 7.2 Специфичные компоненты
- **TransactionStatusIndicator:** Визуализация текущего статуса сделки
- **EscrowVisualizer:** Графическое отображение процесса эскроу
- **SecureChat:** Компонент защищенного чата
- **RatingStars:** Система оценки с звездами
- **DocumentUploader:** Компонент для загрузки и проверки документов
- **CounterpartyCard:** Карточка с информацией о контрагенте
- **TransactionTimeline:** Шкала времени для отслеживания этапов сделки
- **PrivateNoteManager:** Компонент для управления приватными нотами
- **ZKProofGenerator:** Интерфейс для создания и управления доказательствами
- **CircuitSelector:** Выбор подходящего ZK-circuit для операции
- **ProofProgress:** Индикатор прогресса генерации доказательства
- **EncryptionKeyManager:** Управление ключами шифрования

### 7.3 PXE-интеграционные компоненты
- **PXEProvider:** React Context для доступа к PXE
- **NotesManager:** Управление приватными нотами
- **ProofBuilder:** Создание и проверка ZK-доказательств
- **LocalValidator:** Клиентская валидация транзакций
- **SecureStorage:** Работа с зашифрованным хранилищем
- **KeyManager:** Управление криптографическими ключами
- **CircuitLoader:** Загрузка и компиляция Noir-circuits
- **MerkleTreeManager:** Локальное хранение и проверка Merkle-деревьев

## 8. Интеграция с API

### 8.1 Основные API эндпоинты
- `/auth` - регистрация, авторизация, 2FA
- `/users` - профили, рейтинги, поиск
- `/transactions` - создание, управление сделками
- `/documents` - загрузка и получение документов
- `/messages` - чат и коммуникации
- `/notifications` - система уведомлений
- `/zk-verifiers` - верификация ZK-доказательств
- `/notes-metadata` - работа с метаданными нот

### 8.2 Веб-сокеты
- Real-time обновления статусов сделок
- Мгновенные сообщения в чате
- Уведомления о действиях контрагента
- События верификации ZK-доказательств
- Синхронизация статуса приватных нот

### 8.3 PXE API
- Инициализация PXE в браузерном окружении
- Создание и управление приватными ключами
- Генерация и проверка ZK-доказательств
- Работа с нотами (создание, обновление, использование)
- Защищенное локальное хранилище

## 9. Безопасность на фронтенде

### 9.1 Защита критически значимой информации
- **Клиентское шифрование данных:**
  - Шифрование всех чувствительных данных перед передачей на сервер
  - Использование libsodium для сквозного шифрования сообщений
  - Генерация уникальных ключей шифрования для каждой сессии
  - Криптографическая защита всех хранимых на клиенте данных

- **Защита от утечек информации:**
  - Блокировка скриншотов критически важных экранов
  - Предотвращение копирования чувствительной информации
  - Автоматическое очищение кэша после завершения сессии
  - Маскирование чувствительных данных на экране ('***') с возможностью временного просмотра

- **Противодействие цифровым отпечаткам:**
  - Минимизация уникальных идентификаторов браузера
  - Блокировка сторонних скриптов для отслеживания
  - Рандомизация взаимодействия с DOM для противодействия fingerprinting
  - Отключение сбора телеметрии и аналитики, которые могут деанонимизировать пользователя

### 9.2 TOR-специфичная безопасность
- **Адаптация под TOR:**
  - Отсутствие внешних зависимостей, которые могут "протекать" за пределы TOR
  - Блокировка WebRTC и других потенциально опасных API
  - Настройка повышенных таймаутов для нестабильных TOR-соединений
  - Поддержка резервного режима работы при временной недоступности backend

- **Устойчивость к атакам через TOR:**
  - Защита от CSRF с использованием двойных токенов
  - Дополнительный уровень верификации на каждое действие
  - Детектирование попыток перехвата сессии
  - Защита от JS-инъекций и других атак на клиентский код

- **Обработка критических ситуаций:**
  - Функция экстренного уничтожения локальных данных ("panic button")
  - Альтернативные .onion-адреса для доступа при блокировке основного
  - Режим "высокого риска" с дополнительными мерами безопасности
  - Проактивное оповещение о потенциальных угрозах безопасности

### 9.3 Безопасность PXE
- **Защита приватных ключей:**
  - Хранение ключей только в зашифрованном виде
  - Использование hardware-binding где возможно
  - Никогда не передавать приватные ключи по сети
  - Защита от атак при вводе паролей

- **Защита нот и доказательств:**
  - Шифрование всех нот в локальном хранилище
  - Резервное копирование критических данных
  - Изоляция процесса генерации доказательств
  - Контроль использования вычислительных ресурсов

- **Защита от side-channel атак:**
  - Рандомизация времени выполнения криптографических операций
  - Защита от timing атак
  - Изоляция памяти для критических операций
  - Обфускация работы с приватными данными

## 10. Тестирование и качество

### 10.1 Тесты
- Unit-тесты для компонентов
- Integration-тесты для взаимодействия компонентов
- E2E-тесты для пользовательских сценариев
- Специализированные тесты для PXE-интеграции
- Тесты безопасности и приватности
- Проверка корректности ZK-доказательств

### 10.2 Оптимизация производительности
- Lazy loading для компонентов и страниц
- Мемоизация для оптимизации ре-рендеров
- Оптимизация изображений и ресурсов
- Адаптация под низкую пропускную способность TOR
- Оптимизация процесса генерации ZK-доказательств

### 10.3 Обеспечение приватности
- Аудит утечек данных
- Проверка корректности работы PXE
- Тестирование безопасного хранения нот
- Верификация генерации и проверки доказательств

## 11. План разработки

### 11.1 Первая итерация (3-4 недели)
- Разработка базовых компонентов и структуры приложения
- Интеграция базовой версии PXE
- Реализация авторизации и базового дашборда
- Создание макетов основных экранов

### 11.2 Вторая итерация (3-5 недель)
- Интеграция полной версии PXE
- Разработка компонентов для работы с нотами
- Реализация генерации базовых ZK-доказательств
- Интеграция с API для основных операций

### 11.3 Третья итерация (3-5 недель)
- Реализация чата и коммуникаций с E2E шифрованием
- Разработка системы рейтингов и отзывов
- Интеграция механизма условного эскроу
- Полная интеграция с Noir-компилятором

### 11.4 Четвертая итерация (3-4 недели)
- Интеграция с ZK-verifiers на backend
- Реализация управления ключами и нотами
- Улучшение пользовательского интерфейса
- Оптимизация производительности

### 11.5 Финальная итерация (2-3 недели)
- Оптимизация и исправление багов
- Финальное тестирование
- Подготовка к релизу
- Документация для пользователей

## 12. Метрики и аналитика

### 12.1 Основные метрики
- Время, затрачиваемое на создание сделки
- Время генерации ZK-доказательств на клиенте
- Конверсия начатых / завершенных сделок
- Активность пользователей в чате
- Показатели использования разных типов шаблонов
- Успешность верификации ZK-доказательств

### 12.2 События для трекинга (анонимизированные)
- Регистрация и активация аккаунта
- Создание сделки
- Отправка и принятие предложений
- Завершение сделки
- Оставление рейтинга и отзыва
- Генерация и верификация доказательств

## 13. Направления будущего развития

### 13.1 Дополнительные функции
- Настраиваемые шаблоны сделок с приватной логикой
- Расширенные инструменты аналитики для пользователей
- Мультиязычность интерфейса
- Темная тема
- Расширенная система управления приватными нотами

### 13.2 Интеграции
- Мобильное приложение с PXE
- Интеграция с реальными эскроу-механизмами
- Поддержка криптовалют с полной приватностью
- Интеграция смарт-контрактов для сделок
- Клиентские верификаторы для сложных доказательств

### 13.3 Повышение устойчивости в TOR
- Разработка клиентского TOR-мостового соединения для обхода блокировок
- Интеграция с I2P как альтернативной анонимной сетью
- Реализация собственных цепочек луковой маршрутизации для критических данных
- Разработка аварийных протоколов коммуникации при блокировке TOR

### 13.4 Усиление защиты критических данных
- Внедрение полноценного клиентского шифрования с использованием аппаратных ключей
- Разработка протокола доказуемого уничтожения данных на клиенте
- Внедрение системы обнаружения вмешательства (tamper detection)
- Система противодействия утечкам через скрытые каналы (covert channels)

### 13.5 Улучшение UX для приватных операций
- Интуитивный интерфейс подтверждения чувствительных операций
- Визуальное представление уровня безопасности каждого действия
- Кастомизируемые предупреждения о повышенном риске
- Адаптивная система согласия на основе оценки риска действия
- Визуализация процесса генерации ZK-доказательств

## 14. Приложения

### 14.1 Примеры интеграции PXE

```typescript
// Инициализация PXE
import { PXEClient } from '@aztec/pxe';

export async function initializePXE() {
  try {
    const pxe = new PXEClient({
      host: 'http://localhost:8080',
      adapters: {
        evm: true,
        noir: true,
      }
    });
    
    await pxe.initialize();
    return pxe;
  } catch (error) {
    console.error('Failed to initialize PXE:', error);
    throw error;
  }
}
```

```typescript
// Создание приватной ноты
import { Note } from '@aztec/note-manager';

export async function createPrivateNote(pxe, data, owner) {
  try {
    const note = new Note({
      value: data.value,
      owner: owner,
      customData: {
        dealId: data.dealId,
        timestamp: Date.now(),
        status: 'active'
      }
    });
    
    await pxe.notes.create(note);
    return note.commitment;
  } catch (error) {
    console.error('Failed to create note:', error);
    throw error;
  }
}
```

```typescript
// Генерация ZK-доказательства
export async function generateProof(pxe, circuit, inputs) {
  try {
    const compiledCircuit = await pxe.noir.getCompiledCircuit(circuit);
    const proof = await pxe.noir.generateProof(compiledCircuit, inputs);
    return proof;
  } catch (error) {
    console.error('Failed to generate proof:', error);
    throw error;
  }
}
```

### 14.2 Рекомендуемые UI-паттерны для приватных операций

#### A. Индикатор приватности
- Цветовая маркировка полей (приватные/публичные)
- Четкая визуальная индикация для пользователя

#### B. Прогресс генерации доказательства
- Визуализация этапов генерации
- Возможность выполнения в фоновом режиме

#### C. Управление нотами
- Интерфейс отображения активных нот
- Возможность просмотра истории транзакций

#### D. Индикаторы безопасности
- Статус TOR-соединения
- Статус PXE
- Состояние локального хранилища

### 14.3 Ключевые технические вызовы и решения

#### A. Производительность PXE
- Асинхронная генерация доказательств
- Web Worker для тяжелых вычислений
- Кэширование промежуточных результатов

#### B. Восстановление состояния
- Резервное копирование нот
- Механизм синхронизации состояния
- Процедура восстановления

#### C. Совместимость с TOR
- Оптимизация размера пакетов
- Обработка высоких задержек
- Восстановление после обрывов


## 15. Интеграция кошельков через Rainbow SDK

### 15.1 Обзор и требования

#### 15.1.1 Назначение
- Интеграция Rainbow SDK для обеспечения безопасных подключений кошельков через различные провайдеры, включая Metamask, TrustWallet, Ledger и Rabby
- Поддержка взаимодействия EVM-совместимых кошельков со смарт-контрактами платформы
- Сохранение приватности при подключении кошельков в соответствии с принципами анонимности SECTOR8
- Бесшовная интеграция с существующей PXE (Private Execution Environment)

#### 15.1.2 Поддерживаемые провайдеры кошельков
- **Основные кошельки:**
  - Metamask (расширение браузера и мобильное приложение)
  - TrustWallet (мобильное приложение и браузер)
  - Ledger (аппаратный кошелек)
  - Rabby (расширение браузера)
- **Дополнительные кошельки:**
  - Rainbow Wallet
  - Coinbase Wallet
  - Кошельки, совместимые с WalletConnect v2
  - Argent
  - Стандартные инжектированные кошельки

#### 15.1.3 Технические зависимости
- RainbowKit (последняя версия)
- wagmi (основная библиотека хуков для Ethereum)
- ethers.js или viem (библиотека для взаимодействия с Ethereum)
- Web3Modal (опциональное резервное решение)
- WalletConnect v2 SDK

### 15.2 Архитектура интеграции

#### 15.2.1 Интеграция RainbowKit Provider
- Реализация RainbowKit провайдера в корне приложения
- Настройка поддерживаемых сетей (Ethereum, Optimism, Arbitrum и др.)
- Конфигурация кастомной темы в соответствии с дизайн-системой SECTOR8
- Настройка возможностей переключения сетей в интерфейсе
- Пример реализации:

```typescript
import { RainbowKitProvider, darkTheme } from '@rainbow-me/rainbowkit';
import { configureChains, createConfig, WagmiConfig } from 'wagmi';
import { mainnet, optimism, arbitrum } from 'wagmi/chains';
import { alchemyProvider } from 'wagmi/providers/alchemy';
import { publicProvider } from 'wagmi/providers/public';

// Настройка поддерживаемых сетей и провайдеров
const { chains, publicClient } = configureChains(
  [mainnet, optimism, arbitrum],
  [
    alchemyProvider({ apiKey: process.env.ALCHEMY_API_KEY }),
    publicProvider()
  ]
);

// Создание конфигурации wagmi
const wagmiConfig = createConfig({
  autoConnect: false, // Отключено по причинам приватности
  publicClient,
});

// Корень приложения с провайдерами
const App = () => {
  return (
    <WagmiConfig config={wagmiConfig}>
      <RainbowKitProvider 
        chains={chains} 
        theme={darkTheme({
          accentColor: '#0F172A', // SECTOR8 синий
          accentColorForeground: 'white',
          borderRadius: 'medium',
        })}
        appInfo={{
          appName: 'SECTOR8',
          learnMoreUrl: '#',
        }}
      >
        <YourApp />
      </RainbowKitProvider>
    </WagmiConfig>
  );
};